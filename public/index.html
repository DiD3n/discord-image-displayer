<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Discord's content</title>
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            min-width: 100vw;
            overflow: hidden;

            display: flex;
            justify-content: center;
            align-items: center;
        }
        body img {
            max-width: 100vw;
            width: 100%;
            max-height: 100vh;
            object-fit: contain;
        }
    </style>
    <script>
        // DOM's img handle (is exists)
        let img;

        // timeout handler
        let timeout;

        const connect = () => {
            console.log('Connecting...');
            const ws = new WebSocket('ws://localhost:8081');

            ws.onopen = () => {
                console.log('Connected');
            };

            ws.onclose = (event) => {
                console.log('Connection close (reconnect in 1s)',event.reason);
                setTimeout(function() {
                    connect();
                }, 1000);
            };

            ws.onmessage = function(msg) {
                /** @type {WebsocketMessage} */
                msg = JSON.parse(msg.data);

                const clearImg = () => {
                    if (img) {
                        img.remove();
                        img = null;
                    }
                };

                if (msg.type === 'image') {
                    clearImg();

                    img = document.createElement('img');
                    img.src = msg.url;

                    document.body.appendChild(img);

                    if (timeout)
                        clearTimeout(timeout);

                    timeout = setTimeout(function() {
                        clearImg();
                    }, 30000);
                }
            };
        }
        connect();

    </script>
</head>
<body>

</body>
</html>